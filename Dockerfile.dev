# =============================================================================
# Development Dockerfile
# =============================================================================
# Optimized for fast rebuilds and debugging capabilities
# Includes development tools and hot-reload support
# =============================================================================

FROM golang:1.21-alpine AS base

# Install development dependencies
RUN apk add --no-cache \
    git \
    make \
    bash \
    curl \
    ca-certificates \
    gcc \
    musl-dev

WORKDIR /app

# Copy go mod files for dependency caching
COPY server/tenant-mapper/go.mod server/tenant-mapper/go.sum ./
RUN go mod download

# Install air for hot-reload (optional development tool)
RUN go install github.com/cosmtrek/air@latest

# Copy source code
COPY server/tenant-mapper/ ./

# Build the application with debug symbols
RUN CGO_ENABLED=0 GOOS=linux go build -gcflags="all=-N -l" -o tenant-mapper main.go

# Expose port
EXPOSE 80

# Use air for hot reload in development or run directly
CMD ["./tenant-mapper"]
